(function($,undefined){var checkdialog=function(element){var that=$(element);var idname=that.attr('id')||that.attr('name');var pl=that.parent();var sendval=that.val();var vals=[];var texts=[];var btntext=that.attr('btntext')||'请选择';var dltitle=that.attr('dltitle')||'请选择下面选项';var dlwidth=that.attr('dlwidth')||760;var dlheight=that.attr('dlheight')||550;var btnadd=$('<a class="samao-link-btn" style="margin-left:0px" href="#"></a>').text(btntext).insertAfter(that);var input=$('<div style="margin-top:10px; width:500px; border:1px solid #CCC;padding:4px 10px; background:#F7F7F7" class=blu></div>').insertAfter(btnadd);var addval=function(obj){if($.inArray(obj.val,vals)<0){vals.push(obj.val);texts.push(obj.text);}};var delval=function(obj){var inx=$.inArray(obj.val,vals);if(inx>=0){vals=vals.slice(0,inx).concat(vals.slice(inx+1,vals.length));texts=texts.slice(0,inx).concat(texts.slice(inx+1,texts.length));}};var filltexts=function(){input.empty();for(var i in texts){$('<div></div>').text(texts[i]).appendTo(input);}};var fillvals=function(){if(vals.length==0){that.val('');input.empty();}
var valstr=$.toJSON(vals);that.val(valstr);filltexts();};if(sendval!=''){try{vals=$.parseJSON(sendval);}catch(e){vals=[];}}
var url=that.attr('data_url')||'';if(url==''){alert('没有设置data_url连接');}
if(sendval!=''){$.get(url,{ids:sendval},function(msg){texts=msg;filltexts();},'json');}
var dialog=null;;var loadurl=function(url){if(dialog==null){return;}
$.get(url,function(msg){dialog.html(msg);dialog.find('.optitem').each(function(index,element){var elem=$(element);var elemval=elem.val();if($.inArray(elemval,vals)>=0){elem.attr('checked','checked');}});});};$('#checkdialog_'+idname+'.checkdialog .optitem').live('click',function(){var xitem=$(this);var obj={val:xitem.val(),text:xitem.attr('title')};if(xitem.is(':checked')){addval(obj);}
else{delval(obj);}});$('#checkdialog_'+idname+'.checkdialog .samao-pagebar a').live('click',function(){var that=$(this);var xurl=that.attr('href').split('?')[1];loadurl(url+'?'+xurl);return false;});var iopen=function(){dialog=$('<div style="overflow-x:hidden;" class="checkdialog" id="checkdialog_'+idname+'"></div>').attr('title',dltitle).appendTo(document.body);that.mousedown();loadurl(url);dialog.dialog({dialogClass:'ui-widget-content-border',autoOpen:true,width:dlwidth,height:dlheight,modal:true,resizable:false,buttons:{'确认选择':function(){fillvals();dialog.dialog('close');that.change();}},close:function(){dialog.remove();dialog=null;}});return false;};btnadd.click(iopen);};$.fn.checkdialog=function(){this.each(function(index,element){if(!element.checkdialog){element.checkdialog=new checkdialog(element);}});};})(jQuery);